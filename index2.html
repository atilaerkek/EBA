<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filtrelenebilir ve Sıralanabilir Tablo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRNQRgF1h6eJ7ttqY_ETp8CPieXjjufxfRu1EkOWrgZ1zZW2x2sc8PYgbPqlH2AiUTIj2g6NRbDZVKg/pub?output=csv";
            const filterColumns = [
                "Kayıtlı Öğretmen Sayısı", 
                "Son 1 Güne Ait Aktif Öğretmen Sayısı", 
                "Son 1 Güne Ait Aktif Kullanım Oranı", 
                "Son 7 Güne Ait Aktif Öğretmen Sayısı", 
                "Son 7 Güne Ait Aktif Kullanım Oranı", 
                "Son 30 Güne Ait Aktif Öğretmen Sayısı", 
                "Son 30 Güne Ait Aktif Kullanım Oranı", 
                "Son 90 Güne Ait Aktif Öğretmen Sayısı", 
                "Son 90 Güne Ait Aktif Kullanım Oranı"
            ];
            
            fetch(sheetUrl)
                .then(response => response.text())
                .then(csvText => {
                    const data = Papa.parse(csvText, { header: true }).data;
                    if (data.length === 0) return;
                    
                    const table1 = document.getElementById("data-table1");
                    const table2 = document.getElementById("data-table2");
                    const thead1 = table1.createTHead();
                    const tbody1 = table1.createTBody();
                    const thead2 = table2.createTHead();
                    const tbody2 = table2.createTBody();
                    
                    const select = document.getElementById("column-select");
                    filterColumns.forEach(col => {
                        let option = document.createElement("option");
                        option.value = col;
                        option.textContent = col;
                        select.appendChild(option);
                    });
                    
                    function populateTable(sortedData, tableBody) {
                        tableBody.innerHTML = "";
                        sortedData.forEach(row => {
                            let tr = tableBody.insertRow();
                            filterColumns.forEach(col => {
                                let td = tr.insertCell();
                                td.textContent = row[col] || "";
                            });
                        });
                    }
                    
                    function sortAndDisplayTables(sortBy) {
                        let sortedData = [...data].sort((a, b) => {
                            let valA = parseFloat(a[sortBy]) || 0;
                            let valB = parseFloat(b[sortBy]) || 0;
                            return valB - valA;
                        });
                        populateTable(sortedData, tbody1);
                        populateTable(sortedData, tbody2);
                    }
                    
                    // İlk yüklemede varsayılan sıralama
                    sortAndDisplayTables("Kayıtlı Öğretmen Sayısı");
                    select.value = "Kayıtlı Öğretmen Sayısı";
                    
                    // Seçim değiştiğinde sıralama
                    select.addEventListener("change", function () {
                        sortAndDisplayTables(this.value);
                    });
                });
        });
    </script>
</head>
<body>
    <h2>Filtrelenebilir ve Sıralanabilir Tablo</h2>
    <label for="column-select">Sıralama Kriteri:</label>
    <select id="column-select">
    </select>
    
    <h3>Tablo 1</h3>
    <table id="data-table1" border="1"></table>
    
    <h3>Tablo 2</h3>
    <table id="data-table2" border="1"></table>
</body>
</html>
